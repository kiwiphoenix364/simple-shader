class ShaderPack {
    colorArrayNames: string[]
    colorValueArrays: any[]
    constructor(colorArrayNames: string[], colorValueArrays: any[]) {
        this.colorArrayNames = colorArrayNames
        this.colorValueArrays = colorValueArrays
    }
    unpack () {
        let buf = Buffer.create(16)
        for (let i = 0; i < this.colorValueArrays.length; i++) {
            buf = buf.concat(this.colorValueArrays[i])
        }
        return buf
    }
    getTintIdx (color: string) {
        return this.colorArrayNames.indexOf(color)
    }
}
class Shader {
    //Declare initial variables
    //lookup table
    lkupx16: Buffer
    //Shader pack
    currentShader: ShaderPack
    //Decompiled shader pack
    colbuf: Buffer
    //Shader augment image
    bufImg: Image
    //Render and shader buffers
    renderBuf: Buffer
    shaderBuf: Buffer
    //zValue
    zValue: number
    //Renderable for shader
    shader: scene.Renderable
    constructor(currentShader: ShaderPack, zValue: number) {
        this.lkupx16 = Buffer.create(16)
        for (let i = 0; i < 16; i++) {
            this.lkupx16[i] = (i * 16)
        }
        this.zValue = zValue
        this.currentShader = currentShader
        //Unpack Shaderpack
        this.colbuf = this.currentShader.unpack()
        //create buffer image
        this.bufImg = (img`
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            .....................................................................22222222222222222..........................................................................
            .................................................................2222.................2222......................................................................
            ..............................................................222.........................222...................................................................
            ............................................................22...............................22.................................................................
            ..........................................................22...................................22...............................................................
            .........................................................2.......................................2..............................................................
            .......................................................22.........................................22............................................................
            ......................................................2.............................................2...........................................................
            .....................................................2...............................................2..........................................................
            ...................................................22.................................................22........................................................
            ..................................................2.....................................................2.......................................................
            .................................................2.......................................................2......................................................
            ................................................2.........................................................2.....................................................
            ................................................2.........................................................2.....................................................
            ...............................................2...........................................................2....................................................
            ..............................................2......................111111111111111........................2...................................................
            .............................................2.....................1111111111111111111.......................2..................................................
            .............................................2...................11111111111111111111111.....................2..................................................
            ............................................2..................111111111111111111111111111....................2.................................................
            ...........................................2.................1111111111111111111111111111111...................2................................................
            ...........................................2................111111111111111111111111111111111..................2................................................
            ..........................................2................11111111111111111111111111111111111..................2...............................................
            ..........................................2...............1111111111111111111111111111111111111.................2...............................................
            .........................................2...............111111111111111111111111111111111111111.................2..............................................
            .........................................2..............11111111111111111111111111111111111111111................2..............................................
            .........................................2..............11111111111111111111111111111111111111111................2..............................................
            ........................................2..............1111111111111111111111111111111111111111111................2.............................................
            ........................................2..............1111111111111111111111111111111111111111111................2.............................................
            ........................................2.............111111111111111111111111111111111111111111111...............2.............................................
            ........................................2.............111111111111111111111111111111111111111111111...............2.............................................
            .......................................2.............11111111111111111111111111111111111111111111111...............2............................................
            .......................................2.............11111111111111111111111111111111111111111111111...............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            .......................................2............1111111111111111111111111111111111111111111111111..............2............................................
            ........................................2............11111111111111111111111111111111111111111111111..............2.............................................
            ........................................2............11111111111111111111111111111111111111111111111..............2.............................................
            ........................................2.............111111111111111111111111111111111111111111111...............2.............................................
            ........................................2.............111111111111111111111111111111111111111111111...............2.............................................
            .........................................2.............1111111111111111111111111111111111111111111...............2..............................................
            .........................................2.............1111111111111111111111111111111111111111111...............2..............................................
            .........................................2..............11111111111111111111111111111111111111111................2..............................................
            ..........................................2.............11111111111111111111111111111111111111111...............2...............................................
            ..........................................2..............111111111111111111111111111111111111111................2...............................................
            ...........................................2..............1111111111111111111111111111111111111................2................................................
            ...........................................2...............11111111111111111111111111111111111.................2................................................
            ............................................2...............111111111111111111111111111111111.................2.................................................
            .............................................2...............1111111111111111111111111111111.................2..................................................
            .............................................2.................111111111111111111111111111...................2..................................................
            ..............................................2..................11111111111111111111111....................2...................................................
            ...............................................2...................1111111111111111111.....................2....................................................
            ................................................2....................111111111111111......................2.....................................................
            ................................................2.........................................................2.....................................................
            .................................................2.......................................................2......................................................
            ..................................................2.....................................................2.......................................................
            ...................................................22.................................................22........................................................
            .....................................................2...............................................2..........................................................
            ......................................................2.............................................2...........................................................
            .......................................................22.........................................22............................................................
            .........................................................2.......................................2..............................................................
            ..........................................................22...................................22...............................................................
            ............................................................22...............................22.................................................................
            ..............................................................222.........................222...................................................................
            .................................................................2222.................2222......................................................................
            .....................................................................22222222222222222..........................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
        `)
        this.renderBuf = Buffer.create(120)
        this.shaderBuf = Buffer.create(120)
        this.shader = scene.createRenderable(this.zValue, (screenImg: Image, camera: scene.Camera) => {
            for (let x = 0; x < 160; ++x) {
                screenImg.getRows(x, this.renderBuf)
                this.bufImg.getRows(x, this.shaderBuf)
                for (let y = 0; y < 120; ++y) {
                    if (this.bufImg.getPixel(x, y)) {
                        this.renderBuf[y] = (this.colbuf[this.renderBuf[y] + Math.imul(this.shaderBuf[y], 16)])
                    }
                }
                screenImg.setRows(x, this.renderBuf)
            }
        })
    }

}